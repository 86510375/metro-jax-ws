<?xml version="1.0" encoding="UTF-8"?>
<!--

    DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.

    Copyright (c) 2012 Oracle and/or its affiliates. All rights reserved.

    The contents of this file are subject to the terms of either the GNU
    General Public License Version 2 only ("GPL") or the Common Development
    and Distribution License("CDDL") (collectively, the "License").  You
    may not use this file except in compliance with the License.  You can
    obtain a copy of the License at
    http://glassfish.java.net/public/CDDL+GPL_1_1.html
    or packager/legal/LICENSE.txt.  See the License for the specific
    language governing permissions and limitations under the License.

    When distributing the software, include this License Header Notice in each
    file and include the License file at packager/legal/LICENSE.txt.

    GPL Classpath Exception:
    Oracle designates this particular file as subject to the "Classpath"
    exception as provided by Oracle in the GPL Version 2 section of the License
    file that accompanied this code.

    Modifications:
    If applicable, add the following below the License Header, with the fields
    enclosed by brackets [] replaced by your own identifying information:
    "Portions Copyright [year] [name of copyright owner]"

    Contributor(s):
    If you wish your version of this file to be governed by only the CDDL or
    only the GPL Version 2, indicate your decision by adding "[Contributor]
    elects to include this software in this distribution under the [CDDL or GPL
    Version 2] license."  If you don't indicate a single choice of license, a
    recipient has the option to distribute your version of this file under
    either the CDDL, the GPL Version 2 or to extend the choice of license to
    its licensees as provided above.  However, if you add GPL Version 2 code
    and therefore, elected the GPL Version 2 license, then the option applies
    only if the new code is made subject to such option by the copyright
    holder.

-->

<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

    <parent>
        <groupId>com.sun.xml.ws</groupId>
        <artifactId>project</artifactId>
        <version>2.2.8-SNAPSHOT</version>
        <relativePath>../../pom.xml</relativePath>
    </parent>

    <modelVersion>4.0.0</modelVersion>
    <groupId>com.sun.xml.ws</groupId>
    <artifactId>jaxws-unit</artifactId>

    <name>JAX-WS RI Unit Tests</name>
    <description>JAX-WS RI Unit Tests</description>

    <dependencies>
        <dependency>
            <groupId>com.sun.xml.bind</groupId>
            <artifactId>jaxb-impl</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>com.sun.xml.bind</groupId>
            <artifactId>jaxb-xjc</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>com.sun.xml.messaging.saaj</groupId>
            <artifactId>saaj-impl</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>com.sun.xml.stream.buffer</groupId>
            <artifactId>streambuffer</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>org.jvnet.mimepull</groupId>
            <artifactId>mimepull</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>${project.groupId}</groupId>
            <artifactId>policy</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>org.jvnet.staxex</groupId>
            <artifactId>stax-ex</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>javax.servlet-api</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>org.glassfish.ha</groupId>
            <artifactId>ha-api</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>org.glassfish.gmbal</groupId>
            <artifactId>gmbal-api-only</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>org.glassfish.external</groupId>
            <artifactId>management-api</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>com.sun.xml.fastinfoset</groupId>
            <artifactId>FastInfoset</artifactId>
            <scope>provided</scope>
        </dependency>

        <!-- Parsers -->
        <dependency>
            <groupId>org.codehaus.woodstox</groupId>
            <artifactId>woodstox-core-asl</artifactId>
            <scope>provided</scope>
        </dependency>
        <dependency>
            <groupId>org.codehaus.woodstox</groupId>
            <artifactId>stax2-api</artifactId>
            <scope>provided</scope>
        </dependency>
        <!--
        If you want to use SJSXP StAX parser, uncomment this
        and comment woodstox one -->
        <!--
        <dependency>
            <groupId>com.sun.xml.stream</groupId>
            <artifactId>sjsxp</artifactId>
            <version>1.0.1</version>
            <scope>provided</scope>
            <exclusions>
                <exclusion>
                    <artifactId>stax-api</artifactId>
                    <groupId>javax.xml.stream</groupId>
                </exclusion>
            </exclusions>
        </dependency>
        -->
        
        <!-- TODO: needed on mac? -->
        <dependency>
            <groupId>com.sun.org.apache.xml.internal</groupId>
            <artifactId>resolver</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-clean-plugin</artifactId>
                <executions>
                    <execution>
                        <id>default-clean</id>
                        <goals>
                            <goal>clean</goal>
                        </goals>
                        <configuration>
                            <filesets>
                                <fileset>
                                    <directory>${project.build.directory}</directory>
                                </fileset>
                                <fileset>
                                    <directory>testcases</directory>
                                    <includes>
                                        <include>**/work/**</include>
                                    </includes>
                                    <followSymlinks>false</followSymlinks>
                                </fileset>
                            </filesets>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
    
    <profiles>
        <profile>
            <id>ant-test</id>
            <activation>
                <property>
                    <name>!mvnplugin</name>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>prepare-dependencies</id>
                                <goals>
                                    <goal>copy-dependencies</goal>
                                </goals>
                                <configuration>
                                    <outputDirectory>target/dependencies</outputDirectory>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>jaxws-unit-tests</id>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <phase>test</phase>
                                <configuration>
                                    <target>
                                        <property name="libraries.dir" value="target/dependencies"/>
                                        <condition property="test.args" value="${ws.args}" else="-version ${project.osgi.version}">
                                            <isset property="ws.args"/>
                                        </condition>
                                        <condition property="test.test" value="${ws.test}" else="testcases">
                                            <isset property="ws.test"/>
                                        </condition>
                                        <condition property="test.jvmOpts" value="${ws.jvmOpts}" else="">
                                            <isset property="ws.jvmOpts"/>
                                        </condition>
                                        <ant dir="${basedir}" target="run">
                                            <property name="args" value="${test.args}"/>
                                            <property name="test" value="${test.test}"/>
                                            <property name="jvmOpts" value="${test.jvmOpts}"/>
                                            <property name="jaxwsdir" location="${basedir}/../.."/>
                                            <property name="endorsed.dir" value="${endorsed.dir}"/>
                                            <property name="libraries.dir" value="${libraries.dir}"/>
                                        </ant>
                                    </target>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>hudson-invm</id>
            <activation>
                <property>
                    <name>transport</name>
                    <value>IN-VM</value>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>wagon-maven-plugin</artifactId>
                        <version>1.0-beta-4</version>
                        <inherited>false</inherited>
                        <executions>
                            <execution>
                                <id>download-ri</id>
                                <phase>test</phase>
                                <goals>
                                    <goal>download-single</goal>
                                </goals>
                                <configuration>
                                    <url>${hudson.build.id}</url>
                                    <fromFile>artifact/jaxws-ri/bundles/jaxws-ri/target/jaxws-ri.zip</fromFile>
                                    <toDir>target/tested-ri</toDir>
                                </configuration>
                            </execution>
                            <execution>
                                <id>download-transport</id>
                                <phase>test</phase>
                                <goals>
                                    <goal>download-single</goal>
                                </goals>
                                <configuration>
                                    <url>${hudson.build.id}</url>
                                    <fromFile>artifact/jaxws-ri/transports/local/target/jaxws-local-transport.jar</fromFile>
                                    <toDir>target/tested-ri</toDir>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>jaxws-unit-tests</id>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <phase>test</phase>
                                <configuration combine.self="override">
                                    <target>
                                        <unzip src="target/tested-ri/jaxws-ri.zip" dest="target/tested-ri"/>
                                        <property name="ri.endorsed.dir" value="target/tested-ri/jaxws-ri/lib1"/>
                                        <mkdir dir="${ri.endorsed.dir}"/>
                                        <copy todir="${ri.endorsed.dir}">
                                            <fileset dir="target/tested-ri/jaxws-ri/lib" includes="jaxb-api.jar,jaxws-api.jar,saaj-api.jar"/>
                                        </copy>
                                    </target>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <version>1.2.1</version>
                        <executions>
                            <execution>
                                <id>exec</id>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <phase>test</phase>
                                <configuration>
                                    <executable>java</executable>
                                    <arguments>
                                        <argument>-XX:MaxPermSize=128M</argument>
                                        <argument>-Xmx128m</argument>
                                        <argument>-Djava.endorsed.dirs=${project.basedir}/target/tested-ri/jaxws-ri/lib1</argument>
                                        <argument>-Dhttp.proxyHost=www-proxy.us.oracle.com</argument>
                                        <argument>-Dhttp.proxyPort=80</argument>
                                        <argument>-Dhttps.proxyHost=www-proxy.us.oracle.com</argument>
                                        <argument>-Dhttps.proxyPort=80</argument>
                                        <argument>-jar</argument>
                                        <argument>${project.basedir}/lib/harness.jar</argument>
                                        <argument>-version</argument>
                                        <argument>${project.osgi.version}</argument>
                                        <argument>-report</argument>
                                        <argument>${project.basedir}/target/junit-reports</argument>
                                        <argument>-cp:jaxws-image</argument>
                                        <argument>${project.basedir}/target/tested-ri/jaxws-ri</argument>
                                        <argument>-r</argument>
                                        <argument>-transport</argument>
                                        <argument>target/tested-ri/jaxws-local-transport.jar</argument>
                                        <argument>${project.basedir}/testcases</argument>
                                    </arguments>
                                    <successCodes>
                                        <successCode>0</successCode>
                                        <successCode>1</successCode>
                                        <successCode>2</successCode>
                                        <successCode>3</successCode>
                                        <successCode>5</successCode>
                                        <successCode>6</successCode>
                                        <successCode>7</successCode>
                                        <successCode>8</successCode>
                                        <successCode>9</successCode>
                                        <successCode>10</successCode>
                                    </successCodes>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>hudson-lwhs</id>
            <activation>
                <property>
                    <name>transport</name>
                    <value>LWHS</value>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>wagon-maven-plugin</artifactId>
                        <version>1.0-beta-4</version>
                        <inherited>false</inherited>
                        <executions>
                            <execution>
                                <id>download-ri</id>
                                <phase>test</phase>
                                <goals>
                                    <goal>download-single</goal>
                                </goals>
                                <configuration>
                                    <url>${hudson.build.id}</url>
                                    <fromFile>artifact/jaxws-ri/bundles/jaxws-ri/target/jaxws-ri.zip</fromFile>
                                    <toDir>target/tested-ri</toDir>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>jaxws-unit-tests</id>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <phase>test</phase>
                                <configuration combine.self="override">
                                    <target>
                                        <unzip src="target/tested-ri/jaxws-ri.zip" dest="target/tested-ri"/>
                                        <property name="ri.endorsed.dir" value="target/tested-ri/jaxws-ri/lib1"/>
                                        <mkdir dir="${ri.endorsed.dir}"/>
                                        <copy todir="${ri.endorsed.dir}">
                                            <fileset dir="target/tested-ri/jaxws-ri/lib" includes="jaxb-api.jar,jaxws-api.jar,saaj-api.jar"/>
                                        </copy>
                                    </target>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <version>1.2.1</version>
                        <executions>
                            <execution>
                                <id>exec</id>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <phase>test</phase>
                                <configuration>
                                    <executable>java</executable>
                                    <arguments>
                                        <argument>-XX:MaxPermSize=128M</argument>
                                        <argument>-Xmx128m</argument>
                                        <argument>-Djava.endorsed.dirs=${project.basedir}/target/tested-ri/jaxws-ri/lib1</argument>
                                        <argument>-Dhttp.proxyHost=www-proxy.us.oracle.com</argument>
                                        <argument>-Dhttp.proxyPort=80</argument>
                                        <argument>-Dhttps.proxyHost=www-proxy.us.oracle.com</argument>
                                        <argument>-Dhttps.proxyPort=80</argument>
                                        <argument>-jar</argument>
                                        <argument>${project.basedir}/lib/harness.jar</argument>
                                        <argument>-version</argument>
                                        <argument>${project.osgi.version}</argument>
                                        <argument>-report</argument>
                                        <argument>${project.basedir}/target/junit-reports</argument>
                                        <argument>-cp:jaxws-image</argument>
                                        <argument>${project.basedir}/target/tested-ri/jaxws-ri</argument>
                                        <argument>-r</argument>
                                        <argument>-lwhs</argument>
                                        <argument>${project.basedir}/testcases</argument>
                                    </arguments>
                                    <successCodes>
                                        <successCode>0</successCode>
                                        <successCode>1</successCode>
                                        <successCode>2</successCode>
                                        <successCode>3</successCode>
                                        <successCode>5</successCode>
                                        <successCode>6</successCode>
                                        <successCode>7</successCode>
                                        <successCode>8</successCode>
                                        <successCode>9</successCode>
                                        <successCode>10</successCode>
                                    </successCodes>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        <profile>
            <id>hudson-tomcat</id>
            <activation>
                <property>
                    <name>transport</name>
                    <value>TOMCAT</value>
                </property>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>wagon-maven-plugin</artifactId>
                        <version>1.0-beta-4</version>
                        <inherited>false</inherited>
                        <executions>
                            <execution>
                                <id>download-ri</id>
                                <phase>test</phase>
                                <goals>
                                    <goal>download-single</goal>
                                </goals>
                                <configuration>
                                    <url>${hudson.build.id}</url>
                                    <fromFile>artifact/jaxws-ri/bundles/jaxws-ri/target/jaxws-ri.zip</fromFile>
                                    <toDir>target/tested-ri</toDir>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <executions>
                            <execution>
                                <id>jaxws-unit-tests</id>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <phase>test</phase>
                                <configuration combine.self="override">
                                    <target>
                                        <unzip src="target/tested-ri/jaxws-ri.zip" dest="target/tested-ri"/>
                                        <property name="ri.endorsed.dir" value="target/tested-ri/jaxws-ri/lib1"/>
                                        <mkdir dir="${ri.endorsed.dir}"/>
                                        <copy todir="${ri.endorsed.dir}">
                                            <fileset dir="target/tested-ri/jaxws-ri/lib" includes="jaxb-api.jar,jaxws-api.jar,saaj-api.jar"/>
                                        </copy>
                                    </target>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <version>1.2.1</version>
                        <executions>
                            <execution>
                                <id>exec</id>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <phase>test</phase>
                                <configuration>
                                    <executable>java</executable>
                                    <arguments>
                                        <argument>-XX:MaxPermSize=128M</argument>
                                        <argument>-Xmx128m</argument>
                                        <argument>-Djava.endorsed.dirs=${project.basedir}/target/tested-ri/jaxws-ri/lib1</argument>
                                        <argument>-Dhttp.proxyHost=www-proxy.us.oracle.com</argument>
                                        <argument>-Dhttp.proxyPort=80</argument>
                                        <argument>-Dhttps.proxyHost=www-proxy.us.oracle.com</argument>
                                        <argument>-Dhttps.proxyPort=80</argument>
                                        <argument>-jar</argument>
                                        <argument>${project.basedir}/lib/harness.jar</argument>
                                        <argument>-version</argument>
                                        <argument>${project.osgi.version}</argument>
                                        <argument>-report</argument>
                                        <argument>${project.basedir}/target/junit-reports</argument>
                                        <argument>-cp:jaxws-image</argument>
                                        <argument>${project.basedir}/target/tested-ri/jaxws-ri</argument>
                                        <argument>-r</argument>
                                        <argument>-tomcat-embedded</argument>
                                        <argument>${tomcat.home}</argument>
                                        <argument>${project.basedir}/testcases</argument>
                                    </arguments>
                                    <successCodes>
                                        <successCode>0</successCode>
                                        <successCode>1</successCode>
                                        <successCode>2</successCode>
                                        <successCode>3</successCode>
                                        <successCode>5</successCode>
                                        <successCode>6</successCode>
                                        <successCode>7</successCode>
                                        <successCode>8</successCode>
                                        <successCode>9</successCode>
                                        <successCode>10</successCode>
                                    </successCodes>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
        
        <profile>
            <id>mvn-test</id>
            <activation>
                <property>
                    <name>mvnplugin</name>
                    <value>true</value>
                </property>
            </activation>
            <properties>
                <endorsed.dir>${project.build.directory}/endorsed</endorsed.dir>
                <!-- DEFAULT = JAXB, TOPLINK = MOXy -->
                <ws.databinding>DEFAULT</ws.databinding>
                <!-- IN_VM, LWHS, TOMCAT (requires tomcat.home to be set) -->
                <ws.transport>IN_VM</ws.transport>
                <ws.test>${project.basedir}/testcases</ws.test>
            </properties>
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-dependency-plugin</artifactId>
                        <version>2.4</version>
                        <executions>
                            <execution>
                                <id>prepare-endorsed</id>
                                <phase>validate</phase>
                                <goals>
                                    <goal>copy</goal>
                                </goals>
                                <configuration>
                                    <outputDirectory>${endorsed.dir}</outputDirectory>
                                    <silent>false</silent>
                                    <artifactItems>
                                        <artifactItem>
                                            <groupId>javax.xml.bind</groupId>
                                            <artifactId>jaxb-api</artifactId>
                                            <version>${jaxb-api.version}</version>
                                            <type>jar</type>
                                        </artifactItem>
                                        <artifactItem>
                                            <groupId>javax.xml.soap</groupId>
                                            <artifactId>saaj-api</artifactId>
                                            <version>${saaj-api.version}</version>
                                            <type>jar</type>
                                        </artifactItem>
                                        <artifactItem>
                                            <groupId>javax.xml.ws</groupId>
                                            <artifactId>jaxws-api</artifactId>
                                            <version>${jaxws-api.version}</version>
                                            <type>jar</type>
                                        </artifactItem>
                                    </artifactItems>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                    <plugin>
                        <groupId>org.glassfish.metro</groupId>
                        <artifactId>harness-maven-plugin</artifactId>
                        <version>0.1-SNAPSHOT</version>
                        <executions>
                            <execution>
                                <goals>
                                    <goal>ws-test</goal>
                                </goals>
                                <configuration>
                                    <endorsedDir>${endorsed.dir}</endorsedDir>
                                    <tests>${ws.test}</tests>
                                    <version>${project.osgi.version}</version>
                                    <databinding>${ws.databinding}</databinding>
                                    <transport>${ws.transport}</transport>
                                    <imageUrl>${hudson.build.id}/artifact/jaxws-ri/bundles/jaxws-ri/target/jaxws-ri.zip</imageUrl>
                                    <transportUrl>${hudson.build.id}/artifact/jaxws-ri/transports/local/target/jaxws-local-transport.jar</transportUrl>
                                    <!--<debug>true</debug>-->
                                    <args>
                                        <arg>-cp:jaxws ${project.basedir}/../..</arg>
                                    </args>
                                    <vmArgs>
                                        <vmArg>-Dhttp.proxyHost=www-proxy.us.oracle.com</vmArg>
                                        <vmArg>-Dhttp.proxyPort=80</vmArg>
                                        <vmArg>-Dhttps.proxyHost=www-proxy.us.oracle.com</vmArg>
                                        <vmArg>-Dhttps.proxyPort=80</vmArg>
                                    </vmArgs>
                                </configuration>
                            </execution>
                        </executions>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
</project>
